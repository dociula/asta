<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>La Mia Asta Online</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; padding: 40px; background: #f8f9fa; }
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); text-align: center; width: 380px; border-top: 8px solid #007bff; }
        .price-box { background: #e9ecef; padding: 20px; border-radius: 15px; margin: 20px 0; }
        .price { font-size: 45px; color: #007bff; font-weight: bold; display: block; }
        .bidder-label { color: #6c757d; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        #best-bidder { font-weight: bold; color: #343a40; }
        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }
        input { width: 92%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 16px; transition: 0.3s; }
        input:focus { border-color: #007bff; outline: none; }
        button { width: 100%; background: #28a745; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: bold; }
        button:hover { background: #218838; }
        #msg { margin-top: 15px; font-weight: bold; min-height: 1.2em; }
    </style>
</head>
<body>

<div class="card">
    <h2>Asta: Giocatore in chat</h2>
    
    <div class="price-box">
        <span class="bidder-label">Offerta attuale di <span id="best-bidder">...</span></span>
        <span class="price">€ <span id="current-price">0</span></span>
    </div>
    
    <div class="input-group">
        <label for="user-name">Tuo Nome:</label>
        <input type="text" id="user-name" placeholder="Inserisci il tuo nome">
    </div>

    <div class="input-group">
        <label for="bid-amount">Tua Offerta (€):</label>
        <input type="number" id="bid-amount" placeholder="Cifra superiore all'attuale">
    </div>

    <button onclick="placeBid()">Invia Offerta</button>
    <p id="msg"></p>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  // --- INCOLLA QUI I TUOI DATI FIREBASE ---
  const firebaseConfig = {
    apiKey: "AIzaSyDtGgHO7zrSNleKwa0NFr1V9iFfC8JR-CI",
    authDomain: "lamiaastaclaudio.firebaseapp.com",
    databaseURL: "https://lamiaastaclaudio-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "lamiaastaclaudio",
    storageBucket: "lamiaastaclaudio.firebasestorage.app",
    messagingSenderId: "609532970140",
    appId: "1:609532970140:web:b7df1e9ca6275d421a9959"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auctionRef = ref(db, 'auction');

  // Aggiornamento dati in tempo reale
  onValue(auctionRef, (snapshot) => {
    const data = snapshot.val();
    if (data) {
        document.getElementById('current-price').innerText = data.currentPrice || 0;
        document.getElementById('best-bidder').innerText = data.bidderName || "nessuno";
    }
  });

  // Funzione per inviare l'offerta
  window.placeBid = function() {
    const name = document.getElementById('user-name').value;
    const bid = parseFloat(document.getElementById('bid-amount').value);
    const currentPrice = parseFloat(document.getElementById('current-price').innerText);
    const msg = document.getElementById('msg');

    if (!name || name.trim() === "") {
      alert("Per favore, inserisci il tuo nome.");
      return;
    }

    if (bid > currentPrice) {
      update(auctionRef, {
        currentPrice: bid,
        bidderName: name
      }).then(() => {
        msg.innerText = "Offerta accettata! Sei in testa.";
        msg.style.color = "green";
        document.getElementById('bid-amount').value = ""; // Pulisce il campo
      });
    } else {
      msg.innerText = "L'offerta deve essere maggiore di €" + currentPrice;
      msg.style.color = "red";
    }
  };
</script>

</body>
</html>